<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Theme color for PWA -->
    <meta name="theme-color" content="#1f2937" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#f3f4f6" media="(prefers-color-scheme: light)">
    <title>Creature Bank Editor for Heroes 3: ERA</title>
    <base href="/h3-cb-pwa/">
    <!-- Static Manifest -->
    <link rel="manifest" href="./manifest.json">
    <!-- Favicons -->
    <link rel="icon" href="./img/icon-64.png" type="image/png" sizes="64x64">
    <link rel="icon" href="./img/icon-192.png" type="image/png" sizes="192x192">
    <link rel="apple-touch-icon" href="./img/icon-192.png"> <!-- iOS icon -->
    <!-- Stylesheet -->
    <link rel="stylesheet" href="./css/styles.css">
    <!-- JavaScript -->
    <script type="module" src="./js/main.js"></script>
</head>

<body>
<header>
    <div class="title-container">
        <h1 id="app-title">Heroes 3: ERA Objects Editor</h1>
    </div>
    <div>
        <div class="header-controls">
            <button id="install-pwa" class="install-pwa">Install the App</button>
            <div class="theme-toggle">
                <button id="theme-toggle-btn">Dark Theme</button>
            </div>
            <div class="lang-selector">
                <button id="lang-selector-btn">English</button>
                <div class="dropdown" id="lang-dropdown">
                    <!-- Language options will be populated by JS if needed, or keep static -->
                    <button data-lang="en">English</button>
                    <button data-lang="ru">Русский</button>
                </div>
            </div>
        </div>
        <div class="browser-support" id="browser-support">
            <!-- Content populated by JS -->
        </div>
    </div>
</header>

<div class="file-actions">
    <button id="open-json-file" class="file-action-button">Open JSON File</button>
    
    <div class="object-selector-container">
        <select id="object-selector" class="object-selector"></select>
        <div id="duplicate-warning" class="duplicate-warning" style="display: none;">
            <span class="warning-icon">⚠️</span>
            <span class="warning-text">Duplicate subtype</span>
        </div>
        <button id="new-object-btn" class="new-object-btn file-action-button">New</button>
        <button id="action-btn" class="file-action-button" disabled>Remove</button>
    </div>
</div>

<main class="editor-container">
    <!-- Object Subtype -->
    <div class="field-group">
        <h3 id="object-subtype-title">Object parameters</h3>

        <div class="field-row">
            <span class="field-label"> <!-- Changed div to span for inline-flex nature -->
                type <span class="help-icon">?
                    <span class="tooltip" id="help-objectType">Loading help text...</span>
                </span>
            </span>
            <div class="field-input">
                <!-- Displaying as text, not editable -->
                <span id="object-type">16</span>
            </div>
        </div>

        <div class="field-row">
            <label class="field-label" for="object-subtype"> <!-- Use label for accessibility -->
                subtype <span class="help-icon">?
                    <span class="tooltip" id="help-objectSubtype">Loading help text...</span>
                </span>
            </label>
            <div class="field-input">
                <input type="number" id="object-subtype" min="0" value="0">
            </div>
        </div>
    </div>

    <!-- Required Fields -->
    <div class="field-group">
        <h3 id="required-fields-title">Required Fields</h3>

        <div class="field-row">
            <span class="field-label"> <!-- Changed div to span -->
                properties <span class="help-icon">?
                    <span class="tooltip" id="help-properties">Loading help text...</span>
                </span>
            </span>
            <div class="field-input">
                <div id="properties-container">
                    <!-- Property items template/initial item -->
                    <div class="property-item">
                         <!-- Warning icon placeholder -->
                        <input type="text" class="property-input" id="property-0">
                        <button class="remove-property" data-remove-target="property-item">-</button>
                    </div>
                    <!-- More properties added dynamically -->
                </div>
                <pre class="property-hint" id="property-hint-text">
                    <!-- Hint text populated by JS -->
                </pre>
                <button class="add-item" id="add-property"></button>
            </div>
        </div>
    </div>

    <!-- Object Generation -->
    <div class="field-group">
        <h3 id="object-generation-title">Object Generation</h3>

        <div class="field-row">
             <label class="field-label" for="enabled-checkbox"> <!-- Label points to checkbox -->
                <input type="checkbox" id="enabled-checkbox" data-controls="enabled-container value-container density-container">
                enabled <span class="help-icon">?
                    <span class="tooltip" id="help-enabled">Loading help text...</span>
                </span>
            </label>
            <div class="field-input disabled" id="enabled-container">
                <select id="enabled">
                    <option value="true">true</option>
                    <option value="false">false</option>
                </select>
            </div>
        </div>

        <div class="field-row">
            <label class="field-label" for="value">
                value <span class="help-icon">?
                    <span class="tooltip" id="help-value">Loading help text...</span>
                </span>
            </label>
            <div class="field-input disabled" id="value-container">
                <input type="number" id="value" min="0">
            </div>
        </div>

        <div class="field-row">
            <label class="field-label" for="density">
                density <span class="help-icon">?
                    <span class="tooltip" id="help-density">Loading help text...</span>
                </span>
            </label>
            <div class="field-input disabled" id="density-container">
                <input type="number" id="density" min="0">
            </div>
        </div>
    </div>

    <!-- Optional Fields -->
    <div class="field-group">
        <h3 id="optional-fields-title">Optional Fields</h3>

        <!-- Name -->
        <div class="field-row">
            <label class="field-label" for="name-checkbox">
                <input type="checkbox" id="name-checkbox" data-controls="name-container">
                name <span class="help-icon">?
                    <span class="tooltip" id="help-name">Loading help text...</span>
                </span>
            </label>
            <div class="field-input disabled" id="name-container">
                <input type="text" id="name">
            </div>
        </div>

        <!-- Sound -->
        <div class="field-group"> <!-- Wrap complex optional fields in their own group for clarity -->
            <div class="field-row">
                <label class="field-label" for="sound-checkbox">
                    <input type="checkbox" id="sound-checkbox" data-controls="sound-container">
                    sound <span class="help-icon">?
                        <span class="tooltip" id="help-sound">Loading help text...</span>
                    </span>
                </label>
                 <div class="field-input disabled" id="sound-container">
                    <div class="field-group"> <!-- Inner group for sound properties -->
                        <div class="field-row">
                            <label class="field-label margin-left-10" for="sound-enter"> <!-- margin-left-10 kept for visual indent -->
                                enter <span class="help-icon">?
                                    <span class="tooltip" id="help-soundEnter">Loading help text...</span>
                                </span>
                            </label>
                            <div class="field-input">
                                <input type="text" id="sound-enter" placeholder="filename.wav">
                            </div>
                        </div>
                        <div class="field-row">
                            <label class="field-label margin-left-10" for="sound-loop">
                                loop <span class="help-icon">?
                                    <span class="tooltip" id="help-soundLoop">Loading help text...</span>
                                </span>
                             </label>
                            <div class="field-input">
                                <input type="text" id="sound-loop" placeholder="filename.wav">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Text -->
        <div class="field-group">
            <div class="field-row">
                <label class="field-label" for="text-checkbox">
                    <input type="checkbox" id="text-checkbox" data-controls="text-container">
                    text <span class="help-icon">?
                        <span class="tooltip" id="help-text">Loading help text...</span>
                    </span>
                </label>
                <div class="field-input disabled" id="text-container">
                     <div class="field-group">
                        <div class="field-row">
                            <label class="field-label margin-left-10" for="text-visit">
                                visit <span class="help-icon">?
                                    <span class="tooltip" id="help-textVisit">Loading help text...</span>
                                </span>
                            </label>
                            <div class="field-input">
                                <div class="textarea-container">
                                    <textarea id="text-visit" class="resizable-textarea" placeholder="Welcome message..."></textarea>
                                    <!-- Line break indicators added by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- troopPlacement -->
        <div class="field-group">
            <div class="field-row">
                <label class="field-label" for="troopPlacement-checkbox">
                    <input type="checkbox" id="troopPlacement-checkbox" data-controls="troopPlacement-container">
                    troopPlacement <span class="help-icon">?
                        <span class="tooltip" id="help-troopPlacement">Loading help text...</span>
                    </span>
                </label>
                <div class="field-input disabled" id="troopPlacement-container">
                    <div class="field-group">
                        <div class="field-row">
                            <label class="field-label margin-left-10" for="isBank">
                                isBank <span class="help-icon">?
                                    <span class="tooltip" id="help-isBank">Loading help text...</span>
                                </span>
                            </label>
                            <div class="field-input isBank-input-container">
                                <select id="isBank">
                                    <option value="true">true</option>
                                    <option value="false">false</option>
                                </select>
                                <button id="customize-grid-btn" class="customize-btn">Customize</button>
                            </div>
                        </div>
                        <div class="field-row">
                            <label class="field-label margin-left-10" for="attackers">
                                attackers <span class="help-icon">?
                                    <span class="tooltip" id="help-attackers">Loading help text...</span>
                                </span>
                            </label>
                            <div class="field-input">
                                <input type="text" id="attackers" readonly placeholder="[]">
                            </div>
                        </div>
                        <div class="field-row">
                            <label class="field-label margin-left-10" for="defenders">
                                defenders <span class="help-icon">?
                                    <span class="tooltip" id="help-defenders">Loading help text...</span>
                                </span>
                            </label>
                            <div class="field-input">
                                <input type="text" id="defenders" readonly placeholder="[]">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- States -->
        <div class="field-group">
            <div class="field-row states-header-row">
                <label class="field-label-small" for="states-checkbox">
                    <input type="checkbox" id="states-checkbox" data-controls="states-container">
                    states <span class="help-icon">?
                        <span class="tooltip" id="help-states">Loading help text...</span>
                    </span>
                </label>
                <div class="states-buttons">
                    <button class="add-item add-state" id="add-state">Add State</button>
                    <button class="remove-state-btn" id="remove-state-btn" disabled>Remove State</button>
                </div>
            </div>
            <div class="field-input disabled" id="states-container">
                <div class="states-tabs-container">
                    <div class="states-tabs-headers" id="states-tabs-headers">
                        <!-- Tab headers will be added here -->
                    </div>
                    <div id="states-items" class="states-tabs-content">
                        <!-- State item template/initial item will be here or loaded -->
                        <!-- JS will populate the first state here -->
                    </div>
                </div>
            </div>
        </div>

    </div> <!-- End Optional Fields Group -->
</main>

<footer class="bottom-controls">
    <button class="save-button" id="save-file" disabled></button>
    <button class="json-preview-toggle" id="toggle-json"></button>
    <div class="settings-container">
        <button class="settings-button" id="settings-button">
            <img src="./img/gear.svg" alt="Settings" class="settings-icon">
        </button>
        <div class="settings-dropdown" id="settings-dropdown">
            <div class="settings-group">
                <h4></h4>
                <div class="radio-option">
                    <input type="radio" id="indent-2" name="indent-size" value="2" checked>
                    <label for="indent-2"></label>
                </div>
                <div class="radio-option">
                    <input type="radio" id="indent-4" name="indent-size" value="4">
                    <label for="indent-4"></label>
                </div>
            </div>
        </div>
    </div>
    <pre class="json-preview" id="json-preview"></pre> <!-- Use <pre> for formatted code -->
</footer>

<!-- Templates (Hidden) -->
<template id="state-item-template">
    <div class="state-item">
        <div class="field-group">
            <!-- State number is now shown in the tab header -->

            <!-- Spells -->
            <div class="field-group">
                <div class="field-row spells-header-row">
                    <label class="field-label-small">
                        <input type="checkbox" class="state-spells-checkbox" data-controls="state-spells-container">
                        spells <span class="help-icon">?
                            <span class="tooltip" data-translate-id="spells">Loading help text...</span></span>
                    </label>
                    <div class="spells-buttons">
                        <button class="add-spell-btn" id="add-spell-btn"></button>
                        <button class="remove-spell-btn" id="remove-spell-btn" disabled></button>
                    </div>
                </div>
                <div class="field-input disabled state-spells-container">
                    <div class="spells-tabs-container">
                        <div class="spells-tabs-headers">
                            <!-- Spell tab headers will be added here -->
                        </div>
                        <div class="state-spells-items spells-tabs-content">
                            <!-- Spell items will be added here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Skills -->
            <div class="field-group">
                <div class="field-row">
                    <label class="field-label">
                        <input type="checkbox" class="state-skills-checkbox" data-controls="state-skills-container state-skills-primary-container">
                        skills <span class="help-icon">?
                            <span class="tooltip" data-translate-id="skills"></span></span>
                    </label>
                    <div class="field-input disabled state-skills-container">
                        <!-- Inner row for primary skills -->
                        <div class="field-row">
                             <label class="field-label">
                                primary <span class="help-icon">?
                                    <span class="tooltip" data-translate-id="skillsPrimary">Loading help text...</span></span>
                            </label>
                            <div class="field-input disabled state-skills-primary-container">
                                <div class="skills-primary-fields">
                                    <div class="skill-field">
                                        <label class="primary-attack-label"></label>
                                        <input type="number" class="state-skills-primary-attack" min="0" max="127">
                                    </div>
                                    <div class="skill-field">
                                        <label class="primary-defense-label"></label>
                                        <input type="number" class="state-skills-primary-defense" min="0" max="127">
                                    </div>
                                    <div class="skill-field">
                                        <label class="primary-power-label"></label>
                                        <input type="number" class="state-skills-primary-power" min="0" max="127">
                                    </div>
                                    <div class="skill-field">
                                        <label class="primary-knowledge-label"></label>
                                        <input type="number" class="state-skills-primary-knowledge" min="0" max="127">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Creature Reward -->
            <div class="field-group">
                <div class="field-row">
                    <label class="field-label margin-left-10">
                        <input type="checkbox" class="state-creatureReward-checkbox" data-controls="state-creatureReward-container">
                        creatureReward <span class="help-icon">?
                            <span class="tooltip" data-translate-id="creatureReward">Loading help text...</span></span>
                    </label>
                    <div class="field-input disabled state-creatureReward-container">
                        <div class="field-row">
                            <label class="field-label-small">
                                type <span class="help-icon">?
                                    <span class="tooltip" data-translate-id="creatureRewardType">Loading help text...</span></span>
                            </label>
                            <div class="field-input state-creatureRewardType-container">
                                <input type="number" class="state-creatureRewardType-input" min="-1" max="999">
                            </div>
                            
                            <label class="field-label-small">
                                count <span class="help-icon">?
                                    <span class="tooltip" data-translate-id="creatureRewardCount">Loading help text...</span></span>
                            </label>
                            <div class="field-input creature-reward-count state-creatureRewardCount-container">
                                <input type="number" class="state-creatureRewardCount-input" min="0" max="127">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Guardians -->
            <div class="field-group">
                 <div class="field-row">
                    <label class="field-label">
                        <input type="checkbox" class="state-guardians-checkbox" data-controls="state-guardians-container state-guardians-fields-container">
                        guardians <span class="help-icon">?
                            <span class="tooltip" data-translate-id="guardians">Loading help text...</span></span>
                    </label>
                     <div class="field-input disabled state-guardians-container">
                         <div class="disabled state-guardians-fields-container">
                            <!-- Guardians Type Fields Row -->
                            <div class="guardians-fields">
                                <div class="guardian-field">
                                    <label>Type</label>
                                    <input type="number" class="state-guardians-type-1" min="-1" max="999" value="-1">
                                </div>
                                <div class="guardian-field">
                                    <label>Type</label>
                                    <input type="number" class="state-guardians-type-2" min="-1" max="999" value="-1">
                                </div>
                                <div class="guardian-field">
                                    <label>Type</label>
                                    <input type="number" class="state-guardians-type-3" min="-1" max="999" value="-1">
                                </div>
                                <div class="guardian-field">
                                    <label>Type</label>
                                    <input type="number" class="state-guardians-type-4" min="-1" max="999" value="-1">
                                </div>
                                <div class="guardian-field">
                                    <label>Type</label>
                                    <input type="number" class="state-guardians-type-5" min="-1" max="999" value="-1">
                                </div>
                                <div class="guardian-field">
                                    <label>Type</label>
                                    <input type="number" class="state-guardians-type-6" min="-1" max="999" value="-1">
                                </div>
                                <div class="guardian-field">
                                    <label>Type</label>
                                    <input type="number" class="state-guardians-type-7" min="-1" max="999" value="-1">
                                </div>
                            </div>

                            <!-- Guardians Count Fields Row -->
                            <div class="guardians-fields">
                                <div class="guardian-field">
                                    <label>Slot 1</label>
                                    <input type="number" class="state-guardians-count-1" min="0" max="2147483647" value="0">
                                </div>
                                <div class="guardian-field">
                                    <label>Slot 2</label>
                                    <input type="number" class="state-guardians-count-2" min="0" max="2147483647" value="0">
                                </div>
                                <div class="guardian-field">
                                    <label>Slot 3</label>
                                    <input type="number" class="state-guardians-count-3" min="0" max="2147483647" value="0">
                                </div>
                                <div class="guardian-field">
                                    <label>Slot 4</label>
                                    <input type="number" class="state-guardians-count-4" min="0" max="2147483647" value="0">
                                </div>
                                <div class="guardian-field">
                                    <label>Slot 5</label>
                                    <input type="number" class="state-guardians-count-5" min="0" max="2147483647" value="0">
                                </div>
                                <div class="guardian-field">
                                    <label>Slot 6</label>
                                    <input type="number" class="state-guardians-count-6" min="0" max="2147483647" value="0">
                                </div>
                                <div class="guardian-field">
                                    <label>Slot 7</label>
                                    <input type="number" class="state-guardians-count-7" min="0" max="2147483647" value="0">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Upgrade -->
            <div class="field-row">
                <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-upgrade-checkbox" data-controls="state-upgrade-container">
                    upgrade <span class="help-icon">?
                        <span class="tooltip" data-translate-id="upgrade">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-upgrade-container">
                    <input type="number" class="state-upgrade-input" min="0" max="100" value="0">
                </div>
            </div>
            
            <!-- Morale -->
            <div class="field-row">
                <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-morale-checkbox" data-controls="state-morale-container">
                    morale <span class="help-icon">?
                        <span class="tooltip" data-translate-id="statesMorale">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-morale-container">
                    <input type="number" class="state-morale-input" min="-3" max="3">
                </div>
            </div>

            <!-- Luck -->
            <div class="field-row">
                <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-luck-checkbox" data-controls="state-luck-container">
                    luck <span class="help-icon">?
                        <span class="tooltip" data-translate-id="statesLuck">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-luck-container">
                    <input type="number" class="state-luck-input" min="-3" max="3">
                </div>
            </div>

            <!-- Spell Points -->
            <div class="field-row">
                 <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-spellPoints-checkbox" data-controls="state-spellPoints-container">
                    spellPoints <span class="help-icon">?
                        <span class="tooltip" data-translate-id="spellPoints">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-spellPoints-container">
                    <input type="number" class="state-spellPoints-input" min="0" max="999">
                </div>
            </div>

            <!-- Experience -->
            <div class="field-row">
                <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-experience-checkbox" data-controls="state-experience-container">
                    experience <span class="help-icon">?
                        <span class="tooltip" data-translate-id="experience">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-experience-container">
                    <input type="number" class="state-experience-input" min="0" max="2147483647">
                </div>
            </div>

            <!-- ArtifactIds (new section) -->
            <div class="field-row">
                <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-artifactIds-checkbox" data-controls="state-artifactIds-container">
                    artifactIds <span class="help-icon">?
                        <span class="tooltip" data-translate-id="artifactIds">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-artifactIds-container">
                    <div class="artifact-type-fields">
                        <div class="artifact-field">
                            <label>#1</label>
                            <input type="number" class="state-artifactIds-1" min="-1" max="1023" value="-1">
                        </div>
                        <div class="artifact-field">
                            <label>#2</label>
                            <input type="number" class="state-artifactIds-2" min="-1" max="1023" value="-1">
                        </div>
                        <div class="artifact-field">
                            <label>#3</label>
                            <input type="number" class="state-artifactIds-3" min="-1" max="1023" value="-1">
                        </div>
                        <div class="artifact-field">
                            <label>#4</label>
                            <input type="number" class="state-artifactIds-4" min="-1" max="1023" value="-1">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Artifact Type Counts -->
            <div class="field-row">
                <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-artifactTypeCounts-checkbox" data-controls="state-artifactTypeCounts-container">
                    artifactTypeCounts <span class="help-icon">?
                        <span class="tooltip" data-translate-id="artifactTypeCounts">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-artifactTypeCounts-container">
                    <div class="artifact-type-fields">
                        <div class="artifact-field">
                            <label class="artifact-treasure-label"></label>
                            <input type="number" class="state-artifactTypeCounts-treasure" min="0" max="127">
                        </div>
                        <div class="artifact-field">
                            <label class="artifact-minor-label"></label>
                            <input type="number" class="state-artifactTypeCounts-minor" min="0" max="127">
                        </div>
                        <div class="artifact-field">
                            <label class="artifact-major-label"></label>
                            <input type="number" class="state-artifactTypeCounts-major" min="0" max="127">
                        </div>
                        <div class="artifact-field">
                            <label class="artifact-relic-label"></label>
                            <input type="number" class="state-artifactTypeCounts-relic" min="0" max="127">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resources -->
            <div class="field-row">
                <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-resources-checkbox" data-controls="state-resources-container">
                    resources <span class="help-icon">?
                        <span class="tooltip" data-translate-id="resources">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-resources-container">
                    <div class="resources-fields">
                        <div class="resource-field">
                            <label class="resource-wood-label"></label>
                            <input type="number" class="state-resources-wood" min="0" max="2147483647" value="0">
                        </div>
                        <div class="resource-field">
                            <label class="resource-ore-label"></label>
                            <input type="number" class="state-resources-ore" min="0" max="2147483647" value="0">
                        </div>
                        <div class="resource-field">
                            <label class="resource-mercury-label"></label>
                            <input type="number" class="state-resources-mercury" min="0" max="2147483647" value="0">
                        </div>
                        <div class="resource-field">
                            <label class="resource-sulfur-label"></label>
                            <input type="number" class="state-resources-sulfur" min="0" max="2147483647" value="0">
                        </div>
                        <div class="resource-field">
                            <label class="resource-crystal-label"></label>
                            <input type="number" class="state-resources-crystal" min="0" max="2147483647" value="0">
                        </div>
                        <div class="resource-field">
                            <label class="resource-gems-label"></label>
                            <input type="number" class="state-resources-gems" min="0" max="2147483647" value="0">
                        </div>
                        <div class="resource-field">
                            <label class="resource-gold-label"></label>
                            <input type="number" class="state-resources-gold" min="0" max="2147483647" value="0">
                        </div>
                        <div class="resource-field">
                            <label class="resource-mithril-label"></label>
                            <input type="number" class="state-resources-mithril" min="0" max="2147483647" value="0">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Custom DEF File -->
            <div class="field-row">
                <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-customDef-checkbox" data-controls="state-customDef-container">
                    customDef <span class="help-icon">?
                        <span class="tooltip" data-translate-id="customDef">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-customDef-container">
                    <input type="text" class="state-customDef-input" placeholder="filename.def">
                </div>
            </div>

            <!-- Chance -->
            <div class="field-row">
                <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-chance-checkbox" data-controls="state-chance-container">
                    chance <span class="help-icon">?
                        <span class="tooltip" data-translate-id="stateChance">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-chance-container">
                    <input type="number" class="state-chance-input" min="0" max="100">
                </div>
            </div>
        </div>
    </div>
</template>

<template id="spell-item-template">
    <div class="array-item">
        <div class="field-group">
            <!-- Spell ID - Replace field label with radio -->
            <div class="field-row">
                <label class="field-label radio-label">
                    <input type="radio" name="spell-type" class="spell-type-radio" value="id" data-controls="spell-id-container" checked>
                    By ID <span class="help-icon">?
                        <span class="tooltip" data-translate-id="spellsId">Loading help text...</span></span>
                </label>
                <div class="field-input spell-id-container">
                    <input type="number" class="spell-id-input" min="0" max="70">
                </div>
            </div>

            <!-- Spell Bits - Replace field label with radio -->
            <div class="field-row">
                <label class="field-label radio-label">
                    <input type="radio" name="spell-type" class="spell-type-radio" value="bits" data-controls="spell-bits-container spell-bits-flags-container spell-bits-levels-container spell-bits-schools-container">
                    By Bits <span class="help-icon">?
                        <span class="tooltip" data-translate-id="spellsBits">Loading help text...</span></span>
                </label>
                <div class="field-input disabled spell-bits-container">
                    <div class="field-group"> <!-- Inner group for bits -->
                        <div class="field-row">
                            <label class="field-label">
                                flags <span class="help-icon">?
                                    <span class="tooltip" data-translate-id="bitsFlags">Loading help text...</span></span>
                            </label>
                            <div class="field-input disabled spell-bits-flags-container">
                                <!-- Replace select dropdown with checkboxes -->
                                <div class="flags-checkbox-container">
                                    <!-- Checkboxes will be dynamically generated by JS -->
                                </div>
                                <div class="flags-summary">
                                    Selected values: <span class="flags-selected-values"></span>
                                </div>
                                <input type="hidden" class="spell-bits-flags-value">
                            </div>
                        </div>
                        <div class="field-row">
                            <label class="field-label">
                                levels <span class="help-icon">?
                                    <span class="tooltip" data-translate-id="bitsLevels">Loading help text...</span></span>
                            </label>
                            <div class="field-input spell-bits-levels-container">
                                <div class="checkbox-group">
                                    <label><input type="checkbox" class="spell-level-checkbox" value="2"> <span data-spell-level="1">1 lvl</span></label>
                                    <label><input type="checkbox" class="spell-level-checkbox" value="4"> <span data-spell-level="2">2 lvl</span></label>
                                    <label><input type="checkbox" class="spell-level-checkbox" value="8"> <span data-spell-level="3">3 lvl</span></label>
                                    <label><input type="checkbox" class="spell-level-checkbox" value="16"> <span data-spell-level="4">4 lvl</span></label>
                                    <label><input type="checkbox" class="spell-level-checkbox" value="32"> <span data-spell-level="5">5 lvl</span></label>
                                </div>
                                <input type="hidden" class="spell-bits-levels-value">
                            </div>
                        </div>
                        <div class="field-row">
                            <label class="field-label">
                                schools <span class="help-icon">?
                                    <span class="tooltip" data-translate-id="bitsSchools">Loading help text...</span></span>
                            </label>
                            <div class="field-input spell-bits-schools-container">
                                <div class="checkbox-group">
                                    <label><input type="checkbox" class="spell-school-checkbox" value="1"> <span data-spell-school="air">Air</span></label>
                                    <label><input type="checkbox" class="spell-school-checkbox" value="2"> <span data-spell-school="fire">Fire</span></label>
                                    <label><input type="checkbox" class="spell-school-checkbox" value="4"> <span data-spell-school="water">Water</span></label>
                                    <label><input type="checkbox" class="spell-school-checkbox" value="8"> <span data-spell-school="earth">Earth</span></label>
                                </div>
                                <input type="hidden" class="spell-bits-schools-value">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<!-- Hexagonal Grid Popup -->
<div id="grid-popup" class="grid-popup">
    <div class="grid-popup-content">
        <div class="grid-popup-header">
            <h2 id="grid-popup-title">Customize Troop Placement</h2>
            <button id="close-grid-popup" class="close-grid-popup">&times;</button>
        </div>
        <div class="grid-popup-body">
            <div class="mode-switch">
                <div class="mode-hex-preview attackers-preview"></div>
                <button id="attackers-button" class="switch-button active">Attackers</button>
                <div class="mode-hex-preview defenders-preview"></div>
                <button id="defenders-button" class="switch-button">Defenders</button>
                <div class="disabled-cell-toggle-container">
                    <div class="mode-hex-preview blocked-preview"></div>
                    <label class="toggle-switch-label">
                        <input type="checkbox" id="disabled-cells-toggle" checked>
                        <span class="toggle-switch"></span>
                        <span class="disabled-cells-label" id="disabled-cells-label">Toggle Hex Hatching</span>
                    </label>
                </div>
            </div>
            
            <div class="info-row">
                <span class="info-title">Current Mode:</span>
                <span id="current-mode" class="info-content">Attackers</span>
            </div>
            
            <div class="info-row">
                <span class="info-title">Defenders:</span>
                <span id="defenders-count" class="info-content">0/7</span>
                <span id="defenders-cells" class="info-content">[]</span>
            </div>
            
            <div class="info-row">
                <span class="info-title">Attackers:</span>
                <span id="attackers-count" class="info-content">0/7</span>
                <span id="attackers-cells" class="info-content">[]</span>
            </div>
            
            <div class="grid-container" id="hex-grid"></div>
            
            <div class="grid-popup-footer">
                <button id="apply-grid" class="apply-grid">Apply</button>
                <button id="cancel-grid" class="cancel-grid">Cancel</button>
            </div>
        </div>
    </div>
</div>

</body>
</html>
