<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Theme color for PWA -->
    <meta name="theme-color" content="#1f2937" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#f3f4f6" media="(prefers-color-scheme: light)">
    <title>Heroes 3: ERA Objects Editor</title>
    <!-- Dynamic Manifest -->
    <link rel="manifest" href="#" id="manifestPlaceholder">
    <!-- Favicons -->
    <link rel="icon" href="./icon-64.png" type="image/png" sizes="64x64">
    <link rel="icon" href="./icon-192.png" type="image/png" sizes="192x192">
    <link rel="apple-touch-icon" href="./icon-192.png"> <!-- iOS icon -->
    <!-- Stylesheet -->
    <link rel="stylesheet" href="./css/styles.css">
</head>

<body>
<header>
    <div class="title-container">
        <h1 id="app-title">Heroes 3: ERA Objects Editor</h1>
    </div>
    <div>
        <div class="header-controls">
            <button id="install-pwa" class="install-pwa">Install PWA App</button>
            <div class="theme-toggle">
                <button id="theme-toggle-btn">Dark Theme</button>
            </div>
            <div class="lang-selector">
                <button id="lang-selector-btn">English</button>
                <div class="dropdown" id="lang-dropdown">
                    <!-- Language options will be populated by JS if needed, or keep static -->
                    <button data-lang="en">English</button>
                    <button data-lang="ru">Русский</button>
                </div>
            </div>
        </div>
        <div class="browser-support" id="browser-support">
            <!-- Content populated by JS -->
        </div>
    </div>
</header>

<main class="editor-container">
    <!-- Object Subtype -->
    <div class="field-group">
        <h3 id="object-subtype-title">Object parameters</h3>

        <div class="field-row">
            <span class="field-label"> <!-- Changed div to span for inline-flex nature -->
                type <span class="help-icon">?
                    <span class="tooltip" id="help-objectType">Loading help text...</span>
                </span>
            </span>
            <div class="field-input">
                <!-- Displaying as text, not editable -->
                <span>16</span>
            </div>
        </div>

        <div class="field-row">
            <label class="field-label" for="object-subtype"> <!-- Use label for accessibility -->
                subtype <span class="help-icon">?
                    <span class="tooltip" id="help-objectSubtype">Loading help text...</span>
                </span>
            </label>
            <div class="field-input">
                <input type="number" id="object-subtype" min="0" value="13">
            </div>
        </div>
    </div>

    <!-- Required Fields -->
    <div class="field-group">
        <h3 id="required-fields-title">Required Fields</h3>

        <div class="field-row">
            <span class="field-label"> <!-- Changed div to span -->
                properties <span class="help-icon">?
                    <span class="tooltip" id="help-properties">Loading help text...</span>
                </span>
            </span>
            <div class="field-input">
                <div id="properties-container">
                    <!-- Property items template/initial item -->
                    <div class="property-item">
                         <!-- Warning icon placeholder -->
                        <input type="text" class="property-input" id="property-0">
                        <button class="remove-property" data-remove-target="property-item">-</button>
                    </div>
                    <!-- More properties added dynamically -->
                </div>
                <pre class="property-hint" id="property-hint-text">
                    <!-- Hint text populated by JS -->
                </pre>
                <button class="add-item" id="add-property">Add Property</button>
            </div>
        </div>
    </div>

    <!-- Object Generation -->
    <div class="field-group">
        <h3 id="object-generation-title">Object Generation</h3>

        <div class="field-row">
             <label class="field-label" for="enabled-checkbox"> <!-- Label points to checkbox -->
                <input type="checkbox" id="enabled-checkbox" data-controls="enabled-container value-container density-container">
                enabled <span class="help-icon">?
                    <span class="tooltip" id="help-enabled">Loading help text...</span>
                </span>
            </label>
            <div class="field-input disabled" id="enabled-container">
                <select id="enabled">
                    <option value="true">true</option>
                    <option value="false">false</option>
                </select>
            </div>
        </div>

        <div class="field-row">
            <label class="field-label" for="value">
                value <span class="help-icon">?
                    <span class="tooltip" id="help-value">Loading help text...</span>
                </span>
            </label>
            <div class="field-input disabled" id="value-container">
                <input type="number" id="value" min="0">
            </div>
        </div>

        <div class="field-row">
            <label class="field-label" for="density">
                density <span class="help-icon">?
                    <span class="tooltip" id="help-density">Loading help text...</span>
                </span>
            </label>
            <div class="field-input disabled" id="density-container">
                <input type="number" id="density" min="0">
            </div>
        </div>
    </div>

    <!-- Optional Fields -->
    <div class="field-group">
        <h3 id="optional-fields-title">Optional Fields</h3>

        <!-- Name -->
        <div class="field-row">
            <label class="field-label" for="name-checkbox">
                <input type="checkbox" id="name-checkbox" data-controls="name-container">
                name <span class="help-icon">?
                    <span class="tooltip" id="help-name">Loading help text...</span>
                </span>
            </label>
            <div class="field-input disabled" id="name-container">
                <input type="text" id="name">
            </div>
        </div>

        <!-- Sound -->
        <div class="field-group"> <!-- Wrap complex optional fields in their own group for clarity -->
            <div class="field-row">
                <label class="field-label" for="sound-checkbox">
                    <input type="checkbox" id="sound-checkbox" data-controls="sound-container">
                    sound <span class="help-icon">?
                        <span class="tooltip" id="help-sound">Loading help text...</span>
                    </span>
                </label>
                 <div class="field-input disabled" id="sound-container">
                    <div class="field-group"> <!-- Inner group for sound properties -->
                        <div class="field-row">
                            <label class="field-label margin-left-10" for="sound-enter"> <!-- margin-left-10 kept for visual indent -->
                                enter <span class="help-icon">?
                                    <span class="tooltip" id="help-soundEnter">Loading help text...</span>
                                </span>
                            </label>
                            <div class="field-input">
                                <input type="text" id="sound-enter" placeholder="filename.wav">
                            </div>
                        </div>
                        <div class="field-row">
                            <label class="field-label margin-left-10" for="sound-loop">
                                loop <span class="help-icon">?
                                    <span class="tooltip" id="help-soundLoop">Loading help text...</span>
                                </span>
                             </label>
                            <div class="field-input">
                                <input type="text" id="sound-loop" placeholder="filename.wav">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Text -->
        <div class="field-group">
            <div class="field-row">
                <label class="field-label" for="text-checkbox">
                    <input type="checkbox" id="text-checkbox" data-controls="text-container">
                    text <span class="help-icon">?
                        <span class="tooltip" id="help-text">Loading help text...</span>
                    </span>
                </label>
                <div class="field-input disabled" id="text-container">
                     <div class="field-group">
                        <div class="field-row">
                            <label class="field-label margin-left-10" for="text-visit">
                                visit <span class="help-icon">?
                                    <span class="tooltip" id="help-textVisit">Loading help text...</span>
                                </span>
                            </label>
                            <div class="field-input">
                                <div class="textarea-container">
                                    <textarea id="text-visit" class="resizable-textarea" placeholder="Welcome message..."></textarea>
                                    <!-- Line break indicators added by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- States -->
        <div class="field-group">
             <div class="field-row">
                <label class="field-label-small" for="states-checkbox">
                    <input type="checkbox" id="states-checkbox" data-controls="states-container">
                    states <span class="help-icon">?
                        <span class="tooltip" id="help-states">Loading help text...</span>
                    </span>
                </label>
                 <div class="field-input disabled" id="states-container">
                    <div id="states-items">
                        <!-- State item template/initial item will be here or loaded -->
                         <!-- JS will populate the first state here -->
                    </div>
                    <button class="add-item add-state" id="add-state">Add State</button>
                </div>
            </div>
        </div>

    </div> <!-- End Optional Fields Group -->
</main>

<footer class="bottom-controls">
    <button class="save-button" id="save-file" disabled>Save File</button>
    <button class="json-preview-toggle" id="toggle-json">Show JSON Code</button>
    <pre class="json-preview" id="json-preview"></pre> <!-- Use <pre> for formatted code -->
</footer>

<!-- Templates (Hidden) -->
<template id="state-item-template">
    <div class="state-item">
        <div class="field-group">
            <h4>State #<span class="state-number">1</span></h4>

            <!-- Morale -->
            <div class="field-row">
                <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-morale-checkbox" data-controls="state-morale-container">
                    morale <span class="help-icon">?
                        <span class="tooltip" data-translate-id="statesMorale">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-morale-container">
                    <input type="number" class="state-morale-input">
                </div>
            </div>

            <!-- Luck -->
            <div class="field-row">
                <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-luck-checkbox" data-controls="state-luck-container">
                    luck <span class="help-icon">?
                        <span class="tooltip" data-translate-id="statesLuck">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-luck-container">
                    <input type="number" class="state-luck-input">
                </div>
            </div>

            <!-- Spells -->
            <div class="field-group">
                <div class="field-row">
                    <label class="field-label">
                        <input type="checkbox" class="state-spells-checkbox" data-controls="state-spells-container">
                        spells <span class="help-icon">?
                            <span class="tooltip" data-translate-id="spells">Loading help text...</span></span>
                    </label>
                    <div class="field-input disabled state-spells-container">
                        <div class="state-spells-items">
                            <!-- Spell items will be added here -->
                        </div>
                        <button class="add-spell" data-translate-id="addSpell">+</button>
                    </div>
                </div>
            </div>

            <!-- Spell Points -->
            <div class="field-row">
                 <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-spellPoints-checkbox" data-controls="state-spellPoints-container">
                    spellPoints <span class="help-icon">?
                        <span class="tooltip" data-translate-id="spellPoints">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-spellPoints-container">
                    <input type="number" class="state-spellPoints-input" min="0">
                </div>
            </div>

            <!-- Experience -->
            <div class="field-row">
                <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-experience-checkbox" data-controls="state-experience-container">
                    experience <span class="help-icon">?
                        <span class="tooltip" data-translate-id="experience">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-experience-container">
                    <input type="number" class="state-experience-input" min="0">
                </div>
            </div>

            <!-- Skills -->
            <div class="field-group">
                <div class="field-row">
                    <label class="field-label">
                        <input type="checkbox" class="state-skills-checkbox" data-controls="state-skills-container state-skills-primary-container">
                        skills <span class="help-icon">?
                            <span class="tooltip" data-translate-id="skills">Loading help text...</span></span>
                    </label>
                    <div class="field-input disabled state-skills-container">
                        <!-- Inner row for primary skills -->
                        <div class="field-row">
                             <label class="field-label">
                                primary<br>(comma-sep) <span class="help-icon">?
                                    <span class="tooltip" data-translate-id="skillsPrimary">Loading help text...</span></span>
                            </label>
                            <div class="field-input disabled state-skills-primary-container">
                                <input type="text" class="state-skills-primary-input" placeholder="0,1,2,3">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Artifact Type Counts -->
            <div class="field-row">
                <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-artifactTypeCounts-checkbox" data-controls="state-artifactTypeCounts-container">
                    artifactTypeCounts <span class="help-icon">?
                        <span class="tooltip" data-translate-id="artifactTypeCounts">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-artifactTypeCounts-container">
                    <input type="text" class="state-artifactTypeCounts-input" placeholder="0,1,0,0">
                </div>
            </div>

            <!-- Creature Reward Count -->
            <div class="field-row">
                <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-creatureRewardCount-checkbox" data-controls="state-creatureRewardCount-container">
                    creatureRewardCount <span class="help-icon">?
                        <span class="tooltip" data-translate-id="creatureRewardCount">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-creatureRewardCount-container">
                    <input type="number" class="state-creatureRewardCount-input" min="0">
                </div>
            </div>

            <!-- Creature Reward Type -->
            <div class="field-row">
                <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-creatureRewardType-checkbox" data-controls="state-creatureRewardType-container">
                    creatureRewardType <span class="help-icon">?
                        <span class="tooltip" data-translate-id="creatureRewardType">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-creatureRewardType-container">
                    <input type="number" class="state-creatureRewardType-input">
                </div>
            </div>

            <!-- Guardians -->
            <div class="field-group">
                 <div class="field-row">
                    <label class="field-label">
                        <input type="checkbox" class="state-guardians-checkbox" data-controls="state-guardians-container state-guardians-count-container state-guardians-type-container">
                        guardians <span class="help-icon">?
                            <span class="tooltip" data-translate-id="guardians">Loading help text...</span></span>
                    </label>
                     <div class="field-input disabled state-guardians-container">
                         <div class="field-row">
                            <label class="field-label">
                                count<br>(comma-sep) <span class="help-icon">?
                                    <span class="tooltip" data-translate-id="guardiansCount">Loading help text...</span></span>
                            </label>
                            <div class="field-input disabled state-guardians-count-container">
                                <input type="text" class="state-guardians-count-input" placeholder="15,15,15,0,0,0,0">
                            </div>
                        </div>
                         <div class="field-row">
                            <label class="field-label">
                                type<br>(comma-sep) <span class="help-icon">?
                                    <span class="tooltip" data-translate-id="guardiansType">Loading help text...</span></span>
                            </label>
                            <div class="field-input disabled state-guardians-type-container">
                                <input type="text" class="state-guardians-type-input" placeholder="59,59,59,-1,-1,-1,-1">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resources -->
            <div class="field-row">
                <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-resources-checkbox" data-controls="state-resources-container">
                    resources <span class="help-icon">?
                        <span class="tooltip" data-translate-id="resources">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-resources-container">
                    <input type="text" class="state-resources-input" placeholder="0,0,0,0,0,0,2500,12">
                </div>
            </div>

            <!-- Upgrade -->
            <div class="field-row">
                <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-upgrade-checkbox" data-controls="state-upgrade-container">
                    upgrade <span class="help-icon">?
                        <span class="tooltip" data-translate-id="upgrade">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-upgrade-container">
                    <input type="number" class="state-upgrade-input" min="0" value="0">
                </div>
            </div>

            <!-- Chance -->
            <div class="field-row">
                <label class="field-label margin-left-10">
                    <input type="checkbox" class="state-chance-checkbox" data-controls="state-chance-container">
                    chance <span class="help-icon">?
                        <span class="tooltip" data-translate-id="stateChance">Loading help text...</span></span>
                </label>
                <div class="field-input disabled state-chance-container">
                    <input type="number" class="state-chance-input" min="0" max="100">
                </div>
            </div>
        </div>
        <button class="remove-state" data-remove-target="state-item">Remove State</button>
    </div>
</template>

<template id="spell-item-template">
    <div class="array-item">
        <div class="field-group">
            <!-- Spell ID -->
            <div class="field-row">
                <label class="field-label">
                    <input type="checkbox" class="spell-id-checkbox" data-controls="spell-id-container">
                    id <span class="help-icon">?
                        <span class="tooltip" data-translate-id="spellsId">Loading help text...</span></span>
                </label>
                <div class="field-input disabled spell-id-container">
                    <input type="number" class="spell-id-input" min="0">
                </div>
            </div>

            <!-- Spell Bits -->
            <div class="field-row">
                <label class="field-label">
                    <input type="checkbox" class="spell-bits-checkbox" data-controls="spell-bits-container spell-bits-flags-container spell-bits-levels-container spell-bits-schools-container">
                    bits <span class="help-icon">?
                        <span class="tooltip" data-translate-id="spellsBits">Loading help text...</span></span>
                </label>
                <div class="field-input disabled spell-bits-container">
                    <div class="field-group"> <!-- Inner group for bits -->
                         <div class="field-row">
                            <label class="field-label">
                                flags <span class="help-icon">?
                                    <span class="tooltip" data-translate-id="bitsFlags">Loading help text...</span></span>
                            </label>
                            <div class="field-input disabled spell-bits-flags-container">
                                <input type="number" class="spell-bits-flags-input" min="0">
                            </div>
                        </div>
                         <div class="field-row">
                            <label class="field-label">
                                levels <span class="help-icon">?
                                    <span class="tooltip" data-translate-id="bitsLevels">Loading help text...</span></span>
                             </label>
                            <div class="field-input disabled spell-bits-levels-container">
                                <input type="number" class="spell-bits-levels-input" min="0">
                            </div>
                        </div>
                         <div class="field-row">
                            <label class="field-label">
                                schools <span class="help-icon">?
                                    <span class="tooltip" data-translate-id="bitsSchools">Loading help text...</span></span>
                             </label>
                            <div class="field-input disabled spell-bits-schools-container">
                                <input type="number" class="spell-bits-schools-input" min="0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <button class="remove-spell" data-remove-target="array-item">-</button>
    </div>
</template>

<!-- Load JavaScript -->
<script src="./js/script.js" defer></script>

</body>
</html>